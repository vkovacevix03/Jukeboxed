<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover - Jukeboxed</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Full viewport height */
        }

         /* Sidebar style from previous code */
         nav {
            width: 200px;
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100%;
            padding-top: 20px;
        }

        nav .logo-section {
            display: flex;
            align-items: center;
            padding: 10px;
        }

        nav .logo-section img {
            width: 60px;
            height: auto;
            margin-right: 10px;
        }

        nav a {
            padding: 15px;
            text-align: left;
            text-decoration: none;
            color: white;
            display: block;
        }

        nav a:hover {
            background-color: darkred;
        }

        img {
            width: 100%;
            height: 200px; /* Set a fixed height for all images */
            object-fit: cover; /* Ensures images cover the area and keep aspect ratio */
        }

        /* Main content */
        .main-content {
            margin-left: 200px; /* Account for sidebar width */
            padding: 20px;
            flex: 1;
            background-color: #f0f0f0;
        }

        /* Filter button */
        #filterButton {
            padding: 10px 40px;
            background-color: darkred;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* Filter modal styling */
        #filterModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            padding: 20px;
            z-index: 1000;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            text-align: left;
            padding: 15px;
        }

        th {
            background-color: darkred;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f8d7da; /* Light red */
        }

        tr:nth-child(odd) {
            background-color: white;
        }

        tr:hover {
            background-color: #ffe5e9; /* Hover effect */
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .album-container {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .dropdown-header {
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            padding: 10px;
            background-color: #f8f8f8;
            border: 1px solid black;
            text-align: left;
        }

        .dropdown-content {
            display: none;
            padding: 10px;
            border: 1px solid #ccc;
            border-top: none;
            background-color: #f9f9f9;
        }

        select {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 100%;
            background-color: white;
            color: black;
        }
        footer {
            padding: 5px 20px; /* Reduce padding to make it less tall */
            background-color: black;
            color: white;
            text-align: center;
            width: 100%;
            position: fixed;
            bottom: 0;
            left: 0;
        }

        header {
            background-color: darkred;
            text-align: center;
            padding: 20px 10px; /* Padding for space around the logo */
            color: white;
            margin-bottom: 10px;
        }

        header img {
            width: 100px;
            height: auto;
            margin-bottom: 10px;
        }

        header h2 {
            margin: 10px 0 0 0;
            font-size: 20px;
        }
        
    </style>
</head>
<body>
    <nav>
        <div class="logo-section">
            <img src="\jukeboxed\logo-white.png" alt="Logo">
            <span><a target="_blank" href="main.html" style="color: white; text-decoration: none;"><b>Jukeboxed</b></a></span>
        </div>
        <!-- Sidebar -->
        <a href="main.html">Home</a>
        <a href="page2.html">Featured Songs</a>
        <a href="page3.html">About Us</a>
        <a href="page4.html">Discover Artists!</a>
        <a href="search.html">Discover songs!</a>
    </nav>

    <div class="main-content">
            <header>
                <img src="jukeboxed\logo-white.png" alt="Logo">
                <h2>Discover New music</h2>
            </header>
        <button id="filterButton">Discover!</button>
        <div id="overlay"></div>
        <div id="filterModal">
            <h3>Filter Options</h3>
            <div>
                <label for="genre">Filter by Genre</label>
                <select id="genre">
                    <option value="random">All</option>
                    <option value="Pop">Pop</option>
                    <option value="Rock">Rock</option>
                    <option value="Hip Hop">Hip Hop</option>
                    <option value="Country">Country</option>
                    <option value="Jazz">Jazz</option>
                </select>
            </div>
            <div>
                <label for="artist">Filter by Artist</label>
                <select id="artist">
                    <option value="random">All</option>
                    <option value="Michael Jackson">Michael Jackson</option>
                    <option value="Tina Turner">Tina Turner</option>
                    <option value="Lady Gaga">Lady Gaga</option>
                    <option value="Stevie Wonder">Stevie Wonder</option>
                    <option value="Prince">Prince</option>
                    <option value="Nirvana">Nirvana</option>
                    <option value="The Beatles">The Beatles</option>
                    <option value="Pink Floyd">Pink Floyd</option>
                    <option value="Led Zeppelin">Led Zeppelin</option>
                    <option value="The Rolling Stones">The Rolling Stones</option>
                    <option value="Bo Burnham">Bo Burnham</option>
                    <option value="Eminem">Eminem</option>
                    <option value="Wu-Tang Clan">Wu-Tang Clan</option>
                    <option value="Kanye West">Kanye West</option>
                    <option value="Dolly Parton">Dolly Parton</option>
                    <option value="Willie Nelson">Willie Nelson</option>
                    <option value="Waylon Jennings">Waylon Jennings</option>
                    <option value="Nitty Gritty Dirt Band">Nitty Gritty Dirt Band</option>
                    <option value="Brooks & Dunn">Brooks & Dunn</option>
                    <option value="Art Tatum">Art Tatum</option>
                    <option value="John Coltrane">John Coltrane</option>
                    <option value="Bob Dylan">Bob Dylan</option>
                    <option value="Miles Davis">Miles Davis</option>

                </select>
            </div>

            <div>
                <label for="album">Filter by Album</label>
                <select id="album">
                    <option value="random">All</option>
                    <option value="Thriller">Thriller</option>
                    <option value="Private Dancer">Private Dancer</option>
                    <option value="The Fame Monster">The Fame Monster</option>
                    <option value="Songs in the Key of Life">Songs in the Key of Life</option>
                    <option value="Purple Rain">Purple Rain</option>
                    <option value="Nevermind">Nevermind</option>
                    <option value="Revolver">Revolver</option>
                    <option value="Dark Side Of The Moon">Dark Side Of The Moon</option>
                    <option value="Led Zeppelin IV">Led Zeppelin IV</option>
                    <option value="It\'s Only Rock \'n\">It\'s Only Rock \'n\</option>
                    <option value="All Eyez On Me">All Eyez On Me</option>
                    <option value="The Eminem Show">The Eminem Show</option>
                    <option value="Enter the Wu-Tang">Enter the Wu-Tang</option>
                    <option value="The College Dropout">The College Dropout</option>
                    <option value="My Beautiful Dark Twisted Fantasy">My Beautiful Dark Twisted Fantasy</option>
                    <option value="Coat Of Many Colors">Coat Of Many Colors</option>
                    <option value="Red Headed Stranger">Red Headed Stranger</option>
                    <option value="Honky Tonk Heroes">Honky Tonk Heroes</option>
                    <option value="Will The Circle Be Unbroken">Will The Circle Be Unbroken</option>
                    <option value="Hillbilly Deluxe">Hillbilly Deluxe</option>
                    <option value="Piano Starts Here">Piano Starts Here</option>
                    <option value="Blue Train">Blue Train</option>
                    <option value="Time Out">Time Out</option>
                    <option value="Love Supreme">Love Supreme</option>
                    <option value="Kind of Blue">Kind of Blue</option>
                </select>
            </div>

            <button id="updateButton">Update</button>
        </div>
    </div>

    <script>
        const filterButton = document.getElementById('filterButton');
        const filterModal = document.getElementById('filterModal');
        const overlay = document.getElementById('overlay');
        const updateButton = document.getElementById('updateButton');
        let audioPlayer;
        
        // Show the modal
        filterButton.addEventListener('click', () => {
            filterModal.style.display = 'block';
            overlay.style.display = 'block';
        });
        
        // Close the modal
        overlay.addEventListener('click', () => {
            filterModal.style.display = 'none';
            overlay.style.display = 'none';
        });
        
        // Fetch and display data when "Update" is clicked
        updateButton.addEventListener('click', async () => {
            const selectedGenre = document.getElementById('genre').value;
            const selectedArtist = document.getElementById('artist').value;
            const selectedAlbum = document.getElementById('album').value;
        
            try {
                const response = await fetch('http://localhost:3000/filter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ genre: selectedGenre, artist: selectedArtist, album: selectedAlbum })
                });
        
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
        
                const data = await response.json();
                populateTable(data);
            } catch (error) {
                console.error(error);
            } finally {
                filterModal.style.display = 'none';
                overlay.style.display = 'none';
            }
        });
        
        // Populate the table with data from the backend
        function populateTable(data) {
            const mainContent = document.querySelector('.main-content');
            const oldTable = document.getElementById('resultsTable');
            if (oldTable) oldTable.remove();
        
            const table = document.createElement('table');
            table.id = 'resultsTable';
        
            const headers = ['ID', 'Title', 'Album', 'Genre', 'Artist', 'Likes', 'Play Video'];
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);
        
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.setAttribute('data-id', row.id); // Add a unique identifier to the row
        
                const audioButton = `<button onclick="playAudio()">Play</button>`;

                tr.innerHTML = `
                    <td>${row.id}</td>
                    <td>${row.title}</td>
                    <td>${row.album}</td>
                    <td>${row.genre}</td>
                    <td>${row.artist}</td>
                    <td class="like-count">${row.song_likes} <button onclick="likeSong(${row.id})">Like</button></td>
                    <td>${audioButton}</td>
                `;
                table.appendChild(tr);
            });
        
            mainContent.appendChild(table);
        }
        
        // Play YouTube audio
        let audioElement; // Audio element reference

function playAudio() { const audioFilePath = 'Michael Jackson - Wanna Be Startin Somethin (Audio).mp3';

    // If the audio element does not exist, create it
    if (!audioElement) {
        audioElement = document.createElement('audio');
        audioElement.src = audioFilePath;
        audioElement.controls = true; // Enable controls (play, pause, stop)
        audioElement.style.position = 'fixed';
        audioElement.style.bottom = '20px';
        audioElement.style.left = '20px';
        audioElement.style.zIndex = 1000;
        document.body.appendChild(audioElement);
    }

    // Play the audio
    audioElement.play();

    // Show the audio controller
    audioElement.style.display = 'block';

    // Pause any currently playing audio before starting the new one
    audioElement.addEventListener('ended', () => {
        audioElement.style.display = 'none'; // Hide controller when audio ends
    });
}
        // Like a song
        async function likeSong(songId) {
            try {
                // Send the like request to the server
                const response = await fetch('http://localhost:3000/like/song', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ song_id: songId })
                });
        
                if (response.ok) {
                    // If successful, get the updated like count from the backend
                    const updatedCountResponse = await fetch(`http://localhost:3000/song/${songId}`);
                    if (!updatedCountResponse.ok) throw new Error("Failed to fetch updated like count");
        
                    const updatedSong = await updatedCountResponse.json();
        
                    // Update the like count in the table dynamically
                    const likeCell = document.querySelector(`tr[data-id='${songId}'] .like-count`);
                    if (likeCell) {
                        likeCell.textContent = updatedSong.song_likes; // Update the count in the DOM
                    }
        
                    alert("Song liked!");
                } else {
                    alert("Failed to like song.");
                }
            } catch (error) {
                console.error('Error liking song:', error);
            }
        }
        
        
        // Fetch updated data
        async function fetchUpdatedData() {
            const response = await fetch('http://localhost:3000/songs'); // Adjust endpoint as needed
            return response.json();
        }
        
    </script>

    <footer>
        <p>Copyright &copy; 2024 All Rights Reserved - <span>Jukeboxed LLC</span></p>
    </footer>
</body>
</html>

